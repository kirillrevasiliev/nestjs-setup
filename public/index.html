<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <title>Chat Socket.IO</title>
</head>
<body>
  <div id="app" class="container">
    <h1 class="center">{{ title }}</h1>
    <div id="chat" class="row">
      <div class="card col s6 offset-s3">
        <div class="card-content">
          <input type="text" v-model="name" id="username" class="form-control" placeholder="Enter name...">
          <div id="messages" style="height:400px;overflow-y: auto;">
            <ul class="collection" v-if="!!messages.length">
              <li v-for="message of messages" class="collection-item">
                <span class="title">{{ message.name }}:</span>
                <p>{{ message.text }}</p>
              </li>
            </ul>
          </div>
          <br>
        </div>
        <div class="card-action">
          <div class="row">
            <textarea id="textarea" class="form-control" v-model="text" placeholder="Enter message..."></textarea>
          </div>
          <div class="row">
            <button id="send" class="btn" @click.prevent="sendMessage">Send</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.1/socket.io.js" integrity="sha512-9mpsATI0KClwt+xVZfbcf2lJ8IFBAwsubJ6mI3rtULwyM3fBmQFzj0It4tGqxLOGQwGfJdk/G+fANnxfq9/cew==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://unpkg.com/vue@3"></script>
<script>
  const { createApp } = Vue;

  createApp({
    data() {
      return {
        title: 'Nestjs Websockets Chat',
        name: '',
        text: '',
        messages: [],
        socket: null,
      };
    },
    methods: {
      sendMessage() {
        if (this.validateInput()) {
          const message = {
            name: this.name,
            text: this.text,
          };
          this.socket.emit('send_message', message);
          this.text = '';
        }
      },
      receivedMessage(message) {
        this.messages.push(message);
      },
      validateInput() {
        return this.name.length > 0 && this.text.length > 0;
      },
    },
    created() {
      this.socket = io('ws://localhost:3001');
      this.socket.on('receive_message', ({ message }) => {
        this.receivedMessage(message);
      });
    },
  }).mount('#app');
</script>

</html>
